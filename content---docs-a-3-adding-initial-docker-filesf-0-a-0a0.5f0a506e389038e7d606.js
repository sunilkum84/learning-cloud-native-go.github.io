(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{48:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",function(){return i}),t.d(n,"rightToc",function(){return c}),t.d(n,"default",function(){return b});t(0);var a=t(70);function o(){return(o=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e}).apply(this,arguments)}function r(e,n){if(null==e)return{};var t,a,o=function(e,n){if(null==e)return{};var t,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var i={id:"a3.adding_initial_docker_files",title:"Adding initial docker files"},c=[{value:"Adding a Dockerfile",id:"adding-a-dockerfile",children:[]},{value:"Adding a docker-compose.yml",id:"adding-a-docker-composeyml",children:[]},{value:"Support Docker multi-stage builds",id:"support-docker-multi-stage-builds",children:[]}],l={rightToc:c},p="wrapper";function b(e){var n=e.components,t=r(e,["components"]);return Object(a.b)(p,o({},l,t,{components:n,mdxType:"MDXLayout"}),Object(a.b)("p",null,Object(a.b)("a",o({parentName:"p"},{href:"https://docs.docker.com/get-started/#docker-concepts"}),"ðŸ“–")," ",Object(a.b)("a",o({parentName:"p"},{href:"https://www.docker.com/"}),"Docker")," is ",Object(a.b)("strong",{parentName:"p"},"a platform")," for developers and sysadmins ",Object(a.b)("strong",{parentName:"p"},"to develop, deploy, and run applications")," with ",Object(a.b)("strong",{parentName:"p"},"containers"),"."),Object(a.b)("p",null,Object(a.b)("a",o({parentName:"p"},{href:"https://www.docker.com/resources/what-container"}),"ðŸ“–")," A container is ",Object(a.b)("strong",{parentName:"p"},"a standard unit of software")," that packages up code and all its dependencies so the application runs quickly and reliably from one computing environment to another."),Object(a.b)("blockquote",null,Object(a.b)("p",{parentName:"blockquote"},"ðŸ’¡ If you are a newcomer to Docker, I recommend you to read ",Object(a.b)("a",o({parentName:"p"},{href:"https://www.docker.com/resources/what-container"}),Object(a.b)("strong",{parentName:"a"},"What is a Container?"))," article and its ",Object(a.b)("a",o({parentName:"p"},{href:"https://docs.docker.com/get-started/part2/"}),Object(a.b)("strong",{parentName:"a"},"Get Started guild"))," on its official documentation.")),Object(a.b)("h2",{id:"adding-a-dockerfile"},"Adding a Dockerfile"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},"I would like to store all Docker related files inside the ",Object(a.b)("inlineCode",{parentName:"li"},"docker")," folder in the project root, except the ",Object(a.b)("inlineCode",{parentName:"li"},"docker-compose.yml"),"."),Object(a.b)("li",{parentName:"ul"},"We are going to add another ",Object(a.b)("inlineCode",{parentName:"li"},"Dockerfile")," for the database. So, letâ€™s save this code under ",Object(a.b)("inlineCode",{parentName:"li"},"docker/app/Dockerfile"),"."),Object(a.b)("li",{parentName:"ul"},"In here, we are using ",Object(a.b)("inlineCode",{parentName:"li"},"golang:1.13-alpine")," base image with ",Object(a.b)("inlineCode",{parentName:"li"},"gcc"),", ",Object(a.b)("inlineCode",{parentName:"li"},"musl-dev"),", ",Object(a.b)("inlineCode",{parentName:"li"},"git"),", ",Object(a.b)("inlineCode",{parentName:"li"},"bash")," packages.")),Object(a.b)("pre",null,Object(a.b)("code",o({parentName:"pre"},{className:"language-dockerfile"}),"FROM golang:1.13-alpine\nWORKDIR /myapp\n\nRUN apk update && apk add --no-cache gcc musl-dev git bash\n\nCOPY . .\n\nRUN go build -ldflags '-w -s' -a -o ./bin/app ./cmd/app\n\nCMD [\"/myapp/bin/app\"]\nEXPOSE 8080\n")),Object(a.b)("blockquote",null,Object(a.b)("p",{parentName:"blockquote"},"ðŸ”Ž Search the difference between ",Object(a.b)("inlineCode",{parentName:"p"},"golang"),", ",Object(a.b)("inlineCode",{parentName:"p"},"golang:alpine"),", ",Object(a.b)("inlineCode",{parentName:"p"},"golang:stretch"),", ",Object(a.b)("inlineCode",{parentName:"p"},"alpine")," and ",Object(a.b)("inlineCode",{parentName:"p"},"stretch")," Docker images.")),Object(a.b)("h2",{id:"adding-a-docker-composeyml"},"Adding a docker-compose.yml"),Object(a.b)("p",null,Object(a.b)("a",o({parentName:"p"},{href:"https://docs.docker.com/compose/"}),"ðŸ“–")," Compose is a ",Object(a.b)("strong",{parentName:"p"},"tool for defining and running multi-container Docker applications"),". With a single command, we can create and start all the services according to the content in the ",Object(a.b)("inlineCode",{parentName:"p"},"docker-compose.yml")," file."),Object(a.b)("blockquote",null,Object(a.b)("p",{parentName:"blockquote"},"ðŸ’¡ If you are new to Docker Compose, I recommend you to read its ",Object(a.b)("a",o({parentName:"p"},{href:"https://docs.docker.com/compose/gettingstarted/"}),Object(a.b)("strong",{parentName:"a"},"Get Started guild"))," on its official documentation.")),Object(a.b)("p",null,"As mentioned earlier, we keep the ",Object(a.b)("inlineCode",{parentName:"p"},"docker-compose.yml")," in the project root."),Object(a.b)("pre",null,Object(a.b)("code",o({parentName:"pre"},{className:"language-yml"}),"version: '3'\nservices:\n\n  app:\n    build:\n      context: .\n      dockerfile: ./docker/app/Dockerfile\n    ports:\n      - \"8080:8080\"\n")),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},"You can use ",Object(a.b)("inlineCode",{parentName:"li"},"docker-compose build")," and ",Object(a.b)("inlineCode",{parentName:"li"},"docker-compose up")," commands, to build and run the application."),Object(a.b)("li",{parentName:"ul"},"You should see ",Object(a.b)("inlineCode",{parentName:"li"},"Hello World!")," text while visit ",Object(a.b)("inlineCode",{parentName:"li"},"localhost:8080")," in the browser.")),Object(a.b)("h2",{id:"support-docker-multi-stage-builds"},"Support Docker multi-stage builds"),Object(a.b)("p",null,"Docker images with the Go SDK is quite large. Because of Go is a ",Object(a.b)("strong",{parentName:"p"},"statically compiled language"),", after creating the executable files, we donâ€™t need the Go SDK and the codebase to run the application. "),Object(a.b)("pre",null,Object(a.b)("code",o({parentName:"pre"},{className:"language-bash"}),"golang      1.13-alpine      359MB\nalpine      latest           5.58MB\n")),Object(a.b)("p",null,"Docker multi-stage build is a new feature which is using a ",Object(a.b)("strong",{parentName:"p"},"single Docker file")," with multiple stages to ",Object(a.b)("strong",{parentName:"p"},"build the application in one environment")," and ",Object(a.b)("strong",{parentName:"p"},"copy each executable and run on another environment")," to reduce the resources needed in the production environment."),Object(a.b)("p",null,"Letâ€™s update the ",Object(a.b)("inlineCode",{parentName:"p"},"docker/app/Dockerfile")," to support multi-stage builds."),Object(a.b)("pre",null,Object(a.b)("code",o({parentName:"pre"},{className:"language-dockerfile"}),"# Build environment\n# -----------------\nFROM golang:1.13-alpine as build-env\nWORKDIR /myapp\n\nRUN apk update && apk add --no-cache gcc musl-dev git\n\nCOPY . .\n\nRUN go build -ldflags '-w -s' -a -o ./bin/app ./cmd/app\n\n\n# Deployment environment\n# ----------------------\nFROM alpine\nRUN apk update && apk add --no-cache bash\n\nCOPY --from=build-env /myapp/bin/app /myapp/\n\nEXPOSE 8080\nCMD [\"/myapp/app\"]\n")),Object(a.b)("blockquote",null,Object(a.b)("p",{parentName:"blockquote"},"ðŸ’¡ If you don't like to add an extra weight to your images by installing ",Object(a.b)("inlineCode",{parentName:"p"},"bash"),", just use builtin ",Object(a.b)("inlineCode",{parentName:"p"},"ash")," or ",Object(a.b)("inlineCode",{parentName:"p"},"/bin/sh")," shells.")),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},"After updating the ",Object(a.b)("inlineCode",{parentName:"li"},"Dockerfile"),", we need to rebuild and rerun the application."),Object(a.b)("li",{parentName:"ul"},"Always run ",Object(a.b)("inlineCode",{parentName:"li"},"docker-compose down")," before running ",Object(a.b)("inlineCode",{parentName:"li"},"docker-compose up")," to stop running containers and remove containers, networks, volumes, and images created by previous ",Object(a.b)("inlineCode",{parentName:"li"},"up")," commands.")),Object(a.b)("blockquote",null,Object(a.b)("p",{parentName:"blockquote"},"ðŸ’¡ The ",Object(a.b)("inlineCode",{parentName:"p"},"docker images")," command shows all top-level Docker images with their ID, repository name, tag name and the size. You can use the ",Object(a.b)("inlineCode",{parentName:"p"},"docker rmi -f")," command with the image ID to delete any old images from your system.")),Object(a.b)("blockquote",null,Object(a.b)("p",{parentName:"blockquote"},"ðŸ’¡ Better skip using Docker multi-stage builds in the development environment, due to we can reduce the build time of the second step.")))}b.isMDXComponent=!0},70:function(e,n,t){"use strict";t.d(n,"a",function(){return c}),t.d(n,"b",function(){return d});var a=t(0),o=t.n(a),r=o.a.createContext({}),i=function(e){var n=o.a.useContext(r),t=n;return e&&(t="function"==typeof e?e(n):Object.assign({},n,e)),t},c=function(e){var n=i(e.components);return o.a.createElement(r.Provider,{value:n},e.children)};var l="mdxType",p={inlineCode:"code",wrapper:function(e){var n=e.children;return o.a.createElement(o.a.Fragment,{},n)}},b=function(e){var n=e.components,t=e.mdxType,a=e.originalType,r=e.parentName,c=function(e,n){var t={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&-1===n.indexOf(a)&&(t[a]=e[a]);return t}(e,["components","mdxType","originalType","parentName"]),l=i(n),b=t,d=l[r+"."+b]||l[b]||p[b]||a;return n?o.a.createElement(d,Object.assign({},c,{components:n})):o.a.createElement(d,c)};function d(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var r=t.length,i=new Array(r);i[0]=b;var c={};for(var p in n)hasOwnProperty.call(n,p)&&(c[p]=n[p]);c.originalType=e,c[l]="string"==typeof e?e:a,i[1]=c;for(var d=2;d<r;d++)i[d]=t[d];return o.a.createElement.apply(null,i)}return o.a.createElement.apply(null,t)}b.displayName="MDXCreateElement"}}]);