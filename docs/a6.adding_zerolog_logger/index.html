<!DOCTYPE html>
<html lang=&#34;en&#34; data-theme=&#34;&#34;>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<script type="text/javascript">/*<![CDATA[*/window.__chunkMapping={"main":["/main.ffef3bb9b735a46363b7.css","/main.026324ff9d13635d7ab6.js"],"component---site-src-pages-index-jsc-4-f-f99":["/component---site-src-pages-index-jsc-4-f-f99.057e3cfa462e27633c4c.css","/component---site-src-pages-index-jsc-4-f-f99.f43249a66aaf78a9321e.js"],"component---theme-doc-legacy-page-9-e-7-ca5":[],"docsMetadata---docs-84-c-21e":["/docsMetadata---docs-84-c-21e.121c6a3fb0777fef30f2.js"],"component---theme-doc-legacy-item-031-769":["/component---theme-doc-legacy-item-031-769.1f1ce10374de019f5d3a.css","/component---theme-doc-legacy-item-031-769.ad8e7ce024b8bd31bf1c.js"],"content---docs-a-1-creating-a-new-go-project-52-f-ae3":["/content---docs-a-1-creating-a-new-go-project-52-f-ae3.e37d03e451d77e5294aa.js"],"metadata---docs-a-1-creating-a-new-go-project-428-7a6":["/metadata---docs-a-1-creating-a-new-go-project-428-7a6.3f73b92260ba72b7b04b.js"],"content---docs-a-10-adding-initial-books-api-routese-9-d-5b0":["/content---docs-a-10-adding-initial-books-api-routese-9-d-5b0.45a6fcd8d9bddbd568ce.js"],"metadata---docs-a-10-adding-initial-books-api-routes-233-f69":["/metadata---docs-a-10-adding-initial-books-api-routes-233-f69.4d473c634a13fb682450.js"],"content---docs-a-11-implementing-restful-handlersb-98-549":["/content---docs-a-11-implementing-restful-handlersb-98-549.5f5decf3f0ef8d7bbba3.js"],"metadata---docs-a-11-implementing-restful-handlers-232-439":["/metadata---docs-a-11-implementing-restful-handlers-232-439.a7cc1f5db85ead1d7dc1.js"],"content---docs-a-overviewbb-1-a6f":["/content---docs-a-overviewbb-1-a6f.1b88098211a6a9f86aa4.js"],"metadata---docs-a-overview-20-c-750":["/metadata---docs-a-overview-20-c-750.4f607bc5335df44e2feb.js"],"content---docs-a-12-adding-validator-v-96-e-5-0ad":["/content---docs-a-12-adding-validator-v-96-e-5-0ad.5409a79903b0ff5ec46c.js"],"metadata---docs-a-12-adding-validator-v-9812-cdf":["/metadata---docs-a-12-adding-validator-v-9812-cdf.521c6ac3e1a9dfc1710b.js"],"content---docs-a-6-adding-zerolog-loggera-22-c20":["/content---docs-a-6-adding-zerolog-loggera-22-c20.083d59dd16d57abfd856.js"],"metadata---docs-a-6-adding-zerolog-loggerd-5-b-e7b":["/metadata---docs-a-6-adding-zerolog-loggerd-5-b-e7b.822baa6fd904bb037622.js"],"content---docs-a-2-adding-initial-http-server-9-ce-c7a":["/content---docs-a-2-adding-initial-http-server-9-ce-c7a.738f8b0ea14295a6bf7a.js"],"metadata---docs-a-2-adding-initial-http-server-84-f-748":["/metadata---docs-a-2-adding-initial-http-server-84-f-748.fbca7bc6d8b451e218ff.js"],"content---docs-a-4-adding-initial-configurations-4-e-7-5f2":["/content---docs-a-4-adding-initial-configurations-4-e-7-5f2.04263e45e847603044c9.js"],"metadata---docs-a-4-adding-initial-configurationsc-8-a-0cb":["/metadata---docs-a-4-adding-initial-configurationsc-8-a-0cb.5dfd9249af050c2590ad.js"],"content---docs-a-5-adding-chi-routerbb-4-1ff":["/content---docs-a-5-adding-chi-routerbb-4-1ff.5f4c636743910e971749.js"],"metadata---docs-a-5-adding-chi-router-5-cd-243":["/metadata---docs-a-5-adding-chi-router-5-cd-243.320cc87fdbf6a1b96268.js"],"content---docs-a-7-adding-db-docker-filef-8-f-b43":["/content---docs-a-7-adding-db-docker-filef-8-f-b43.2bf83ec4bd736e6b67be.js"],"metadata---docs-a-7-adding-db-docker-fileb-76-4cf":["/metadata---docs-a-7-adding-db-docker-fileb-76-4cf.dbcec36c4564b0f6ee00.js"],"content---docs-a-8-adding-initial-database-migrations-9-cf-d23":["/content---docs-a-8-adding-initial-database-migrations-9-cf-d23.24a73246f321ddac7fb1.js"],"metadata---docs-a-8-adding-initial-database-migrations-937-1ae":["/metadata---docs-a-8-adding-initial-database-migrations-937-1ae.b80c143a04755746b894.js"],"content---docs-a-9-adding-gormf-78-427":["/content---docs-a-9-adding-gormf-78-427.d227880956ae0fd29e33.js"],"metadata---docs-a-9-adding-gorm-33-d-b05":["/metadata---docs-a-9-adding-gorm-33-d-b05.f94b8b210915102dec19.js"],"content---docs-a-3-adding-initial-docker-filesf-0-a-0a0":["/content---docs-a-3-adding-initial-docker-filesf-0-a-0a0.56427bd69b3221fc4736.js"],"metadata---docs-a-3-adding-initial-docker-files-55-a-745":["/metadata---docs-a-3-adding-initial-docker-files-55-a-745.499461250f21fd8b61b9.js"],"content---docs-indexc-37-eeb":["/content---docs-indexc-37-eeb.d476692c3e97e5e378bb.js"],"metadata---docs-index-5-b-7-7e4":["/metadata---docs-index-5-b-7-7e4.ba6d66c78bbed2a73092.js"]};/*]]>*/</script>

<title data-react-helmet="true">Adding Zerolog logger</title>

<meta data-react-helmet="true" charset="utf-8"/><meta data-react-helmet="true" http-equiv="x-ua-compatible" content="ie=edge"/><meta data-react-helmet="true" name="viewport" content="width=device-width"/><meta data-react-helmet="true" property="og:title" content="Adding Zerolog logger"/><meta data-react-helmet="true" name="description" content="&gt; ⭐ While using microservices architectures, multiple services might be invoked to handle a single client request. The **[`Syslog`](https://en.wikipedia.org/wiki/Syslog)** is a [message logging protocol](https://en.wikipedia.org/wiki/Log_file) which can be used to send all log events in different systems to a centralized log storage like [`Graylog`](https://www.graylog.org/), [`Stackdriver`](https://cloud.google.com/logging/), [`ELK Stack`](https://www.elastic.co/what-is/elk-stack), to provide visibility into the behavior of microservices. There are many powerful logging libraries which support [Syslog](https://en.wikipedia.org/wiki/Syslog) standards in Go like [`uber-go/zap`](https://github.com/uber-go/zap), [`apex/log`](https://github.com/apex/log), [`sirupsen/logrus`](https://github.com/Sirupsen/logrus), [`rs/zerolog`](https://github.com/rs/zerolog). In here, we are using **[`rs/zerolog`](https://github.com/rs/zerolog)** due to its speed and lesser allocations."/><meta data-react-helmet="true" property="og:description" content="&gt; ⭐ While using microservices architectures, multiple services might be invoked to handle a single client request. The **[`Syslog`](https://en.wikipedia.org/wiki/Syslog)** is a [message logging protocol](https://en.wikipedia.org/wiki/Log_file) which can be used to send all log events in different systems to a centralized log storage like [`Graylog`](https://www.graylog.org/), [`Stackdriver`](https://cloud.google.com/logging/), [`ELK Stack`](https://www.elastic.co/what-is/elk-stack), to provide visibility into the behavior of microservices. There are many powerful logging libraries which support [Syslog](https://en.wikipedia.org/wiki/Syslog) standards in Go like [`uber-go/zap`](https://github.com/uber-go/zap), [`apex/log`](https://github.com/apex/log), [`sirupsen/logrus`](https://github.com/Sirupsen/logrus), [`rs/zerolog`](https://github.com/rs/zerolog). In here, we are using **[`rs/zerolog`](https://github.com/rs/zerolog)** due to its speed and lesser allocations."/><meta data-react-helmet="true" property="og:url" content="https://learning-cloud-native-go.github.io/docs/a6.adding_zerolog_logger"/><meta data-react-helmet="true" name="twitter:card" content="summary"/>

<link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"/>


<link rel="stylesheet" type="text/css" href="/main.ffef3bb9b735a46363b7.css" />

<link rel="stylesheet" type="text/css" href="/1.196ce05925ea6d776920.css" />

<link rel="stylesheet" type="text/css" href="/35.297168503529ced8d75d.css" />

<link rel="stylesheet" type="text/css" href="/component---theme-doc-legacy-item-031-769.1f1ce10374de019f5d3a.css" />

</head>
<body >
<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a aria-current="page" class="navbar__brand active" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="Learning Cloud Native Go"/><strong>Learning Cloud Native Go</strong></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" label="Docs" position="right" href="/docs/index">Docs</a><a class="navbar__item navbar__link" href="https://github.com/learning-cloud-native-go/website" label="GitHub" position="right" target="_blank" rel="noopener noreferrer">GitHub</a><div class="react-toggle displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_16vC moon_1N64"></span></div><div class="react-toggle-track-x"><span class="toggle_16vC sun_3CZP"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"/></div></div></div><div role="presentation" class="navbar__sidebar__backdrop"></div><div class="navbar__sidebar"><div class="navbar__sidebar__brand"><a aria-current="page" class="navbar__brand active" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="Learning Cloud Native Go"/><strong>Learning Cloud Native Go</strong></a></div><div class="navbar__sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" label="Docs" position="right" href="/docs/index">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="https://github.com/learning-cloud-native-go/website" label="GitHub" position="right" target="_blank" rel="noopener noreferrer">GitHub</a></li></ul></div></div></div></nav><div class="container container--fluid"><div class="row"><div class="col col--3"><div class="sidebar_Qb2S"><div class="menu menu--responsive"><button aria-label="Open Menu" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_1uhT" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="#!">Documentation</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/index">Overview</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="#!">Let&#x27;s Get It Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/a.overview">Building a Dockerized RESTful API application</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/a1.creating_a_new_go_project">Creating a new Go project</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/a2.adding_initial_http_server">Adding initial HTTP server</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/a3.adding_initial_docker_files">Adding initial docker files</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/a4.adding_initial_configurations">Adding initial configurations</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/a5.adding_chi_router">Adding Chi router</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/docs/a6.adding_zerolog_logger">Adding Zerolog logger</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/a7.adding_db_docker_file">Adding DB docker file</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/a8.adding_initial_database_migrations">Adding initial database migrations</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/a9.adding_gorm">Adding GORM</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/a10.adding_initial_books_api_routes">Adding initial books API routes</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/a11.implementing_restful_handlers">Implementing RESTful handlers</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/a12.adding_validator.v9">Adding Validator.v9</a></li></ul></li></ul></div></div></div><main class="col"><div><div class="padding-vert--lg"><div class="row"><div class="col"><div class="docItemContainer_3Gws"><header><h1 class="margin-bottom--lg">Adding Zerolog logger</h1></header><article><div class="markdown"><blockquote><p>⭐ While using microservices architectures, multiple services might be invoked to handle a single client request. The <strong><a href="https://en.wikipedia.org/wiki/Syslog"><code>Syslog</code></a></strong> is a <a href="https://en.wikipedia.org/wiki/Log_file">message logging protocol</a> which can be used to send all log events in different systems to a centralized log storage like <a href="https://www.graylog.org/"><code>Graylog</code></a>, <a href="https://cloud.google.com/logging/"><code>Stackdriver</code></a>, <a href="https://www.elastic.co/what-is/elk-stack"><code>ELK Stack</code></a>, to provide visibility into the behavior of microservices. There are many powerful logging libraries which support <a href="https://en.wikipedia.org/wiki/Syslog">Syslog</a> standards in Go like <a href="https://github.com/uber-go/zap"><code>uber-go/zap</code></a>, <a href="https://github.com/apex/log"><code>apex/log</code></a>, <a href="https://github.com/Sirupsen/logrus"><code>sirupsen/logrus</code></a>, <a href="https://github.com/rs/zerolog"><code>rs/zerolog</code></a>. In here, we are using <strong><a href="https://github.com/rs/zerolog"><code>rs/zerolog</code></a></strong> due to its speed and lesser allocations.</p></blockquote><h2><a aria-hidden="true" class="anchor" id="adding-zerolog-as-the-syslog-logger"></a><a aria-hidden="true" class="hash-link" href="#adding-zerolog-as-the-syslog-logger">#</a>Adding Zerolog as the Syslog logger</h2><ul><li><p>We need to run <code>go get github.com/rs/zerolog</code> to download and install the package. As you know, this updates <code>go.mod</code> and <code>go.sum</code> files as well.</p></li><li><p>Let&#x27;s create a global logger under <code>util/logger/logger.go</code> by wrapping <code>zerolog.Logger</code>. We can find an example under <code>rs/zerolog/log</code> package.</p></li></ul><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2QGZ"><pre class="prism-code language-go codeBlock_19pQ" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token keyword" style="color:rgb(127, 219, 202)">package</span><span class="token plain"> logger</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;context&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;io&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;os&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;github.com/rs/zerolog&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">type</span><span class="token plain"> Logger </span><span class="token keyword" style="color:rgb(127, 219, 202)">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    logger </span><span class="token operator" style="color:rgb(127, 219, 202)">*</span><span class="token plain">zerolog</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Logger</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">New</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">isDebug </span><span class="token builtin" style="color:rgb(130, 170, 255)">bool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">*</span><span class="token plain">Logger </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    logLevel </span><span class="token operator" style="color:rgb(127, 219, 202)">:=</span><span class="token plain"> zerolog</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">InfoLevel</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> isDebug </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        logLevel </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> zerolog</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">DebugLevel</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    zerolog</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">SetGlobalLevel</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">logLevel</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    logger </span><span class="token operator" style="color:rgb(127, 219, 202)">:=</span><span class="token plain"> zerolog</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">New</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">os</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Stderr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">With</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Timestamp</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Logger</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">&amp;</span><span class="token plain">Logger</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">logger</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">&amp;</span><span class="token plain">logger</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">NewConsole</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">isDebug </span><span class="token builtin" style="color:rgb(130, 170, 255)">bool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">*</span><span class="token plain">Logger </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    logLevel </span><span class="token operator" style="color:rgb(127, 219, 202)">:=</span><span class="token plain"> zerolog</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">InfoLevel</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> isDebug </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        logLevel </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> zerolog</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">DebugLevel</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    zerolog</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">SetGlobalLevel</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">logLevel</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    logger </span><span class="token operator" style="color:rgb(127, 219, 202)">:=</span><span class="token plain"> zerolog</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">New</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">os</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Stdout</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">With</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Timestamp</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Logger</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">&amp;</span><span class="token plain">Logger</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">logger</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">&amp;</span><span class="token plain">logger</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// Output duplicates the global logger and sets w as its output.</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">func</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">l </span><span class="token operator" style="color:rgb(127, 219, 202)">*</span><span class="token plain">Logger</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">Output</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">w io</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Writer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> zerolog</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Logger </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> l</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">logger</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Output</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">w</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button></div></pre><blockquote><p>💡 Above code block shows how to convert the code in <a href="https://github.com/rs/zerolog/blob/master/log/log.go"><code>rs/zerolog/log</code></a> to <code>util/logger/logger.go</code>. Due to we need to prevent using lengthy code blocks in this article, I have added only one method/ <code>Output()</code> in the above code. <a href="https://github.com/learning-cloud-native-go/myapp/tree/step-6/util/logger">The complete code</a> can be found on <code>util/logger</code> package with tests.</p></blockquote><ul><li><p>In the previous step, we used <code>isDebug</code> boolean parameter to choose the log level. We set the log level as <code>Debug</code>, only if that value is true. Otherwise, we set it as <code>Info</code>. Let&#x27;s add this to our configurations by adding <code>DEBUG=true</code> to <code>docker/app/.env</code> and by adding <code>Debug bool ˋenv:&quot;DEBUG,required&quot;ˋ</code> to <code>config/config.go</code> <code>Conf</code> struct. Check the <a href="https://github.com/learning-cloud-native-go/myapp/tree/step-6"><code>step-6</code> branch</a> for the complete code.</p></li><li><p>Let&#x27;s update <code>cmd/app/main.go</code> to use new <a href="https://github.com/learning-cloud-native-go/myapp/tree/step-6/util/logger"><code>util/logger</code></a> instead the default <a href="https://golang.org/pkg/log/"><code>log</code></a> package.</p></li></ul><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2QGZ"><pre class="prism-code language-go codeBlock_19pQ" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;fmt&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;net/http&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;myapp/app/router&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;myapp/config&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    lr </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;myapp/util/logger&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    appConf </span><span class="token operator" style="color:rgb(127, 219, 202)">:=</span><span class="token plain"> config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">AppConfig</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    logger </span><span class="token operator" style="color:rgb(127, 219, 202)">:=</span><span class="token plain"> lr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">New</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">appConf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Debug</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    appRouter </span><span class="token operator" style="color:rgb(127, 219, 202)">:=</span><span class="token plain"> router</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">New</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    address </span><span class="token operator" style="color:rgb(127, 219, 202)">:=</span><span class="token plain"> fmt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Sprintf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;:%d&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> appConf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Server</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Port</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    logger</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Info</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Msgf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Starting server %v&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    s </span><span class="token operator" style="color:rgb(127, 219, 202)">:=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">&amp;</span><span class="token plain">http</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Server</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        Addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">         address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        Handler</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">      appRouter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        ReadTimeout</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">  appConf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Server</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">TimeoutRead</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        WriteTimeout</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> appConf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Server</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">TimeoutWrite</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        IdleTimeout</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">  appConf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Server</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">TimeoutIdle</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(127, 219, 202)">:=</span><span class="token plain"> s</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">ListenAndServe</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(127, 219, 202)">!=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">nil</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">&amp;&amp;</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(127, 219, 202)">!=</span><span class="token plain"> http</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ErrServerClosed </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        logger</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Fatal</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Err</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">err</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Msg</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Server startup failed&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button></div></pre><h2><a aria-hidden="true" class="anchor" id="implementing-a-request-logger"></a><a aria-hidden="true" class="hash-link" href="#implementing-a-request-logger">#</a>Implementing a request logger</h2><blockquote><p>💭 Besides the main application events, it&#x27;s helpful having logs of each request and response details. For that we can create a custom <a href="https://golang.org/pkg/net/http/#Handler"><code>Handler</code></a> which maps <code>ServeHTTP(ResponseWriter, *Request)</code> signature and an embedded <code>util/logger</code> to log request and response details.</p><p>🔎 A good example can be found in <a href="https://github.com/google/go-cloud/blob/master/server/requestlog/requestlog.go"><code>google/go-cloud/server/requestlog</code></a>.</p></blockquote><ul><li>Let&#x27;s create the new custom <a href="https://golang.org/pkg/net/http/#Handler"><code>Handler</code></a> under <code>app/handler/handler.go</code>. Later, we will use the <code>NewHandler()</code> function to convert normal handlers to this custom handlers. If you don&#x27;t like the naming <code>app/handler</code> use <code>app/requestlog</code>.</li></ul><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2QGZ"><pre class="prism-code language-go codeBlock_19pQ" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token keyword" style="color:rgb(127, 219, 202)">package</span><span class="token plain"> handler</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;io&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;io/ioutil&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;net&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;net/http&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;time&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;myapp/util/logger&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">type</span><span class="token plain"> Handler </span><span class="token keyword" style="color:rgb(127, 219, 202)">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    handler http</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Handler</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    logger  </span><span class="token operator" style="color:rgb(127, 219, 202)">*</span><span class="token plain">logger</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Logger</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">NewHandler</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">h http</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">HandlerFunc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> l </span><span class="token operator" style="color:rgb(127, 219, 202)">*</span><span class="token plain">logger</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Logger</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">*</span><span class="token plain">Handler </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">&amp;</span><span class="token plain">Handler</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        handler</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> h</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        logger</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">  l</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">func</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">h </span><span class="token operator" style="color:rgb(127, 219, 202)">*</span><span class="token plain">Handler</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">ServeHTTP</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">w http</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ResponseWriter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> r </span><span class="token operator" style="color:rgb(127, 219, 202)">*</span><span class="token plain">http</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Request</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    start </span><span class="token operator" style="color:rgb(127, 219, 202)">:=</span><span class="token plain"> time</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Now</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    le </span><span class="token operator" style="color:rgb(127, 219, 202)">:=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">&amp;</span><span class="token plain">logEntry</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        ReceivedTime</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">      start</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        RequestMethod</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">     r</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Method</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        RequestURL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">        r</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">URL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">String</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        RequestHeaderSize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">headerSize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">r</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Header</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        UserAgent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">         r</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">UserAgent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        Referer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">           r</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Referer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        Proto</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">             r</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Proto</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        RemoteIP</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">          </span><span class="token function" style="color:rgb(130, 170, 255)">ipFromHostPort</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">r</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">RemoteAddr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ok </span><span class="token operator" style="color:rgb(127, 219, 202)">:=</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Context</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">http</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">LocalAddrContextKey</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">net</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> ok </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        le</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ServerIP </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">ipFromHostPort</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">String</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    r2 </span><span class="token operator" style="color:rgb(127, 219, 202)">:=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">new</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">http</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Request</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token operator" style="color:rgb(127, 219, 202)">*</span><span class="token plain">r2 </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">*</span><span class="token plain">r</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    rcc </span><span class="token operator" style="color:rgb(127, 219, 202)">:=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">&amp;</span><span class="token plain">readCounterCloser</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">r</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Body</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    r2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Body </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> rcc</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    w2 </span><span class="token operator" style="color:rgb(127, 219, 202)">:=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">&amp;</span><span class="token plain">responseStats</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">w</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> w</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    h</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">handler</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">ServeHTTP</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">w2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> r2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    le</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Latency </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> time</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Since</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">start</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> rcc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">err </span><span class="token operator" style="color:rgb(127, 219, 202)">==</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">nil</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">&amp;&amp;</span><span class="token plain"> rcc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">r </span><span class="token operator" style="color:rgb(127, 219, 202)">!=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// If the handler hasn&#x27;t encountered an error in the Body (like EOF),</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// then consume the rest of the Body to provide an accurate rcc.n.</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        io</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Copy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ioutil</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Discard</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> rcc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    le</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">RequestBodySize </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> rcc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">n</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    le</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Status </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> w2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">code</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> le</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Status </span><span class="token operator" style="color:rgb(127, 219, 202)">==</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        le</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Status </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> http</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">StatusOK</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    le</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ResponseHeaderSize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> le</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ResponseBodySize </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> w2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">size</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    h</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">logger</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Info</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">Time</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;received_time&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> le</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ReceivedTime</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">Str</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;method&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> le</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">RequestMethod</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">Str</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;url&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> le</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">RequestURL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">Int64</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;header_size&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> le</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">RequestHeaderSize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">Int64</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;body_size&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> le</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">RequestBodySize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">Str</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;agent&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> le</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">UserAgent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">Str</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;referer&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> le</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Referer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">Str</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;proto&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> le</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Proto</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">Str</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;remote_ip&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> le</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">RemoteIP</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">Str</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;server_ip&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> le</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ServerIP</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">Int</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;status&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> le</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Status</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">Int64</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;resp_header_size&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> le</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ResponseHeaderSize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">Int64</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;resp_body_size&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> le</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ResponseBodySize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">Dur</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;latency&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> le</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Latency</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">Msg</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button></div></pre><ul><li>To keep the code cleaner, the code related with log entry is moved to <code>app/handler/logEntry.go</code>.</li></ul><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2QGZ"><pre class="prism-code language-go codeBlock_19pQ" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token keyword" style="color:rgb(127, 219, 202)">package</span><span class="token plain"> handler</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;errors&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;io&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;net&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;net/http&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;time&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">type</span><span class="token plain"> logEntry </span><span class="token keyword" style="color:rgb(127, 219, 202)">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    ReceivedTime      time</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Time</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    RequestMethod     </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    RequestURL        </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    RequestHeaderSize </span><span class="token builtin" style="color:rgb(130, 170, 255)">int64</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    RequestBodySize   </span><span class="token builtin" style="color:rgb(130, 170, 255)">int64</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    UserAgent         </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    Referer           </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    Proto             </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    RemoteIP </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    ServerIP </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    Status             </span><span class="token builtin" style="color:rgb(130, 170, 255)">int</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    ResponseHeaderSize </span><span class="token builtin" style="color:rgb(130, 170, 255)">int64</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    ResponseBodySize   </span><span class="token builtin" style="color:rgb(130, 170, 255)">int64</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    Latency            time</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Duration</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">ipFromHostPort</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">hp </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    h</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(127, 219, 202)">:=</span><span class="token plain"> net</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">SplitHostPort</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">hp</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(127, 219, 202)">!=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">len</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">h</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">&amp;&amp;</span><span class="token plain"> h</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;[&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> h</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">len</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">h</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token operator" style="color:rgb(127, 219, 202)">-</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> h</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">type</span><span class="token plain"> readCounterCloser </span><span class="token keyword" style="color:rgb(127, 219, 202)">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    r   io</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ReadCloser</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    n   </span><span class="token builtin" style="color:rgb(130, 170, 255)">int64</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    err </span><span class="token builtin" style="color:rgb(130, 170, 255)">error</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">func</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">rcc </span><span class="token operator" style="color:rgb(127, 219, 202)">*</span><span class="token plain">readCounterCloser</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">Read</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">p </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token builtin" style="color:rgb(130, 170, 255)">byte</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">n </span><span class="token builtin" style="color:rgb(130, 170, 255)">int</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> err </span><span class="token builtin" style="color:rgb(130, 170, 255)">error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> rcc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">err </span><span class="token operator" style="color:rgb(127, 219, 202)">!=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> rcc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">err</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    n</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> rcc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">err </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> rcc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">r</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Read</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">p</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    rcc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">n </span><span class="token operator" style="color:rgb(127, 219, 202)">+=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">int64</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">n</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> n</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> rcc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">err</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">func</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">rcc </span><span class="token operator" style="color:rgb(127, 219, 202)">*</span><span class="token plain">readCounterCloser</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">Close</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">error</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    rcc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">err </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> errors</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">New</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;read from closed reader&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> rcc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">r</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Close</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">type</span><span class="token plain"> writeCounter </span><span class="token builtin" style="color:rgb(130, 170, 255)">int64</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">func</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">wc </span><span class="token operator" style="color:rgb(127, 219, 202)">*</span><span class="token plain">writeCounter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">Write</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">p </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token builtin" style="color:rgb(130, 170, 255)">byte</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">n </span><span class="token builtin" style="color:rgb(130, 170, 255)">int</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> err </span><span class="token builtin" style="color:rgb(130, 170, 255)">error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token operator" style="color:rgb(127, 219, 202)">*</span><span class="token plain">wc </span><span class="token operator" style="color:rgb(127, 219, 202)">+=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">writeCounter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">len</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">p</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">len</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">p</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">nil</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">headerSize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">h http</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Header</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">int64</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">var</span><span class="token plain"> wc writeCounter</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    h</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Write</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(127, 219, 202)">&amp;</span><span class="token plain">wc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">int64</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">wc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// for CRLF</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">type</span><span class="token plain"> responseStats </span><span class="token keyword" style="color:rgb(127, 219, 202)">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    w     http</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ResponseWriter</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    hsize </span><span class="token builtin" style="color:rgb(130, 170, 255)">int64</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    wc    writeCounter</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    code  </span><span class="token builtin" style="color:rgb(130, 170, 255)">int</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">func</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">r </span><span class="token operator" style="color:rgb(127, 219, 202)">*</span><span class="token plain">responseStats</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">Header</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> http</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Header </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">w</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Header</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">func</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">r </span><span class="token operator" style="color:rgb(127, 219, 202)">*</span><span class="token plain">responseStats</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">WriteHeader</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">statusCode </span><span class="token builtin" style="color:rgb(130, 170, 255)">int</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">code </span><span class="token operator" style="color:rgb(127, 219, 202)">!=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    r</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">hsize </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">headerSize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">r</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">w</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Header</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    r</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">w</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">WriteHeader</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">statusCode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    r</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">code </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> statusCode</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">func</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">r </span><span class="token operator" style="color:rgb(127, 219, 202)">*</span><span class="token plain">responseStats</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">Write</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">p </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token builtin" style="color:rgb(130, 170, 255)">byte</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">n </span><span class="token builtin" style="color:rgb(130, 170, 255)">int</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> err </span><span class="token builtin" style="color:rgb(130, 170, 255)">error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">code </span><span class="token operator" style="color:rgb(127, 219, 202)">==</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        r</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">WriteHeader</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">http</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">StatusOK</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    n</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">w</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Write</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">p</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    r</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">wc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Write</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">p</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">n</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">func</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">r </span><span class="token operator" style="color:rgb(127, 219, 202)">*</span><span class="token plain">responseStats</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">size</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">hdr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> body </span><span class="token builtin" style="color:rgb(130, 170, 255)">int64</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">code </span><span class="token operator" style="color:rgb(127, 219, 202)">==</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">headerSize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">r</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">w</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Header</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// Use the header size from the time WriteHeader was called.</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// The Header map can be mutated after the call to add HTTP Trailers,</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// which we don&#x27;t want to count.</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">hsize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">int64</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">r</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">wc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button></div></pre><h2><a aria-hidden="true" class="anchor" id="creating-the-main-app-package"></a><a aria-hidden="true" class="hash-link" href="#creating-the-main-app-package">#</a>Creating the main app package</h2><blockquote><p>💭 In the previous steps, we just created a global <code>Syslog</code> logger and a custom <a href="https://golang.org/pkg/net/http/#Handler"><code>Handler</code></a> which logs each request and response details. We need to integrate both of them with our application handles like <code>app/app/indexHandler.go</code>.</p></blockquote><ul><li>One way to set the logger as a dependency for our server application is, creating a struct with embedded <a href="https://github.com/rs/zerolog"><code>rs/zerolog</code></a> logger, to represent our server application and then attach our application handles to that struct. For that, let&#x27;s create the <code>App struct</code> under <code>app/app/app.go</code>. If you don&#x27;t like the naming <code>app/app/app.go</code> , I recommend you to name this as <code>app/server/server.go</code> with <code>Server struct</code> or <code>server/app/app.go</code> with <code>App struct</code>.</li></ul><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2QGZ"><pre class="prism-code language-go codeBlock_19pQ" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token keyword" style="color:rgb(127, 219, 202)">package</span><span class="token plain"> app</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;myapp/util/logger&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">type</span><span class="token plain"> App </span><span class="token keyword" style="color:rgb(127, 219, 202)">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    logger </span><span class="token operator" style="color:rgb(127, 219, 202)">*</span><span class="token plain">logger</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Logger</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">New</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">logger </span><span class="token operator" style="color:rgb(127, 219, 202)">*</span><span class="token plain">logger</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Logger</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">*</span><span class="token plain">App </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">&amp;</span><span class="token plain">App</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">logger</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> logger</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">func</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">app </span><span class="token operator" style="color:rgb(127, 219, 202)">*</span><span class="token plain">App</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">Logger</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">*</span><span class="token plain">logger</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Logger </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> app</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">logger</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button></div></pre><blockquote><p>⭐ However, this is not the most efficient way of packaging Go applications. But to make the project more accessible for different levels of programmers, especially for the newcomers to Go web API development, we assume all API always depends on the same set of dependencies.</p><p>💡 With this structure, we can easily load application dependencies inside handlers. For the moment it&#x27;s only about a <a href="https://en.wikipedia.org/wiki/Syslog"><code>Syslog</code></a> logger. Same way, we can add the DB connections, <a href="https://redis.io/">Redis</a> connections, messaging systems like <a href="https://nats.io/">NATS</a> and etc.</p></blockquote><ul><li>Then, let’s convert the <code>HandleIndex()</code> function in <code>app/app/indexHandler.go</code> to a method of above <code>App struct</code>.</li></ul><p><code>func (app *App) HandleIndex(w http.ResponseWriter, _ *http.Request) {</code></p><ul><li>Now, let&#x27;s update <code>app/router/router.go</code> to use <code>NewHandler()</code> function in <code>app/handler</code> to convert the normal handlers into the custom handlers which logs request and response details.</li></ul><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2QGZ"><pre class="prism-code language-go codeBlock_19pQ" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;github.com/go-chi/chi&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;myapp/app/app&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;myapp/app/handler&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">New</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token operator" style="color:rgb(127, 219, 202)">*</span><span class="token plain">app</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">App</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">*</span><span class="token plain">chi</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Mux </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    l </span><span class="token operator" style="color:rgb(127, 219, 202)">:=</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Logger</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    r </span><span class="token operator" style="color:rgb(127, 219, 202)">:=</span><span class="token plain"> chi</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">NewRouter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    r</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Method</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;GET&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;/&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> handler</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">NewHandler</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">HandleIndex</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> l</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> r</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button></div></pre><ul><li>Due to we are passing <code>*App</code> to the <code>New()</code> function in <code>app/router</code>, we have to update <code>cmd/app/main.go</code>.</li></ul><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2QGZ"><pre class="prism-code language-go codeBlock_19pQ" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;fmt&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;net/http&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;myapp/app/app&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;myapp/app/router&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;myapp/config&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    lr </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;myapp/util/logger&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    appConf </span><span class="token operator" style="color:rgb(127, 219, 202)">:=</span><span class="token plain"> config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">AppConfig</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    logger </span><span class="token operator" style="color:rgb(127, 219, 202)">:=</span><span class="token plain"> lr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">New</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">appConf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Debug</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    application </span><span class="token operator" style="color:rgb(127, 219, 202)">:=</span><span class="token plain"> app</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">New</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">logger</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    appRouter </span><span class="token operator" style="color:rgb(127, 219, 202)">:=</span><span class="token plain"> router</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">New</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">application</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button></div></pre><ul><li>Rebuild and rerun the application. You should see the same <code>Hello World!</code> response on <code>localhost:8080</code>, as well as logs like this.</li></ul><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2QGZ"><pre class="prism-code language-json codeBlock_19pQ" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token property" style="color:rgb(128, 203, 196)">&quot;level&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;info&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token property" style="color:rgb(128, 203, 196)">&quot;received_time&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;2019-08-05T13:37:29Z&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token property" style="color:rgb(128, 203, 196)">&quot;method&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;GET&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token property" style="color:rgb(128, 203, 196)">&quot;url&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;/&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token property" style="color:rgb(128, 203, 196)">&quot;header_size&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token number" style="color:rgb(247, 140, 108)">322</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token property" style="color:rgb(128, 203, 196)">&quot;body_size&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token property" style="color:rgb(128, 203, 196)">&quot;agent&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:71.0) Gecko/20100101 Firefox/71.0&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token property" style="color:rgb(128, 203, 196)">&quot;referer&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token property" style="color:rgb(128, 203, 196)">&quot;proto&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;HTTP/1.1&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token property" style="color:rgb(128, 203, 196)">&quot;remote_ip&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;172.18.0.1&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token property" style="color:rgb(128, 203, 196)">&quot;server_ip&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;172.18.0.2&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token property" style="color:rgb(128, 203, 196)">&quot;status&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token number" style="color:rgb(247, 140, 108)">200</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token property" style="color:rgb(128, 203, 196)">&quot;resp_header_size&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token number" style="color:rgb(247, 140, 108)">96</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token property" style="color:rgb(128, 203, 196)">&quot;resp_body_size&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token number" style="color:rgb(247, 140, 108)">12</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token property" style="color:rgb(128, 203, 196)">&quot;latency&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token number" style="color:rgb(247, 140, 108)">0.068137</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token property" style="color:rgb(128, 203, 196)">&quot;time&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;2019-09-02T13:37:29Z&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button></div></pre></div></article><div class="margin-top--xl margin-bottom--lg"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/a5.adding_chi_router"><h5 class="pagination-nav__link--sublabel">Previous</h5><h4 class="pagination-nav__link--label">« <!-- -->Adding Chi router</h4></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/a7.adding_db_docker_file"><h5 class="pagination-nav__link--sublabel">Next</h5><h4 class="pagination-nav__link--label">Adding DB docker file<!-- --> »</h4></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2wxO"><ul class="contents contents__left-border"><li><a href="#adding-zerolog-as-the-syslog-logger" class="contents__link">Adding Zerolog as the Syslog logger</a></li><li><a href="#implementing-a-request-logger" class="contents__link">Implementing a request logger</a></li><li><a href="#creating-the-main-app-package" class="contents__link">Creating the main app package</a></li></ul></div></div></div></div></div></main></div></div>
</div>

<script type="text/javascript" src="/runtime~main.0127a70769823f57619a.js"></script>

<script type="text/javascript" src="/main.026324ff9d13635d7ab6.js"></script>

<script type="text/javascript" src="/0.7d2b14462134a915594f.js"></script>

<script type="text/javascript" src="/1.f33964de80f870a6753b.js"></script>

<script type="text/javascript" src="/35.3462703236f194b00e31.js"></script>

<script type="text/javascript" src="/docsMetadata---docs-84-c-21e.121c6a3fb0777fef30f2.js"></script>

<script type="text/javascript" src="/component---theme-doc-legacy-item-031-769.ad8e7ce024b8bd31bf1c.js"></script>

<script type="text/javascript" src="/content---docs-a-6-adding-zerolog-loggera-22-c20.083d59dd16d57abfd856.js"></script>

<script type="text/javascript" src="/metadata---docs-a-6-adding-zerolog-loggerd-5-b-e7b.822baa6fd904bb037622.js"></script>

</body>
</html>